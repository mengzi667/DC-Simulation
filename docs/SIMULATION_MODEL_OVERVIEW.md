
---

## 1.概述

方法：simpy

- **基准场景**: 每天06:00-24:00运营（18小时）
- **场景1**: 
- **场景2**: 
- **场景3**: 

运行30天，每个场景重复5次，收集KPI

---

## 2.Entitys

### 2.1 卡车

**基本属性**：
- 类别：FG和R&P两类
- 方向：inbound, outbound
- 装载量：携带的托盘数量（根据业务类型不同而变化）

**时间属性**：
- 预定到达时间：计划到达DC的时间
- 实际到达时间：真实到达的时间
- 服务开始时间：开始装卸货的时间
- 服务结束时间：完成装卸货的时间
- 发运时限：必须在此时间前完成装车并发出（仅FG出库卡车）**SLA??**

**生命周期**：
```
生成 → 到达DC → 等待dock空闲 → 占用dock → 装/卸货 → 释放dock → 离开
```

### 2.2 订单

每个订单记录：

- 订单编号和货物数量
- 下单时间和要求发货时间
- 实际完成时间
- 是否按时完成 **SLA??**

---

## 3.Resource

### 3.1 dock设施

**类型**：
1. **FG Loading**：用于FG装车
   - 容量：营业时段稳定保持1个dock
   - 特点：需求相对稳定，48周实际数据显示几乎不需要增减

2. **FG Reception**：用于FG卸货入库
   - 容量：0-2个dock（时变配置）
   - 特点：随时段调整，晚间减少

3. **R&P Loading**：用于R&P装车
   - 容量：3-6个dock（时变配置）
   - 特点：**需求最大**，高峰时段需要6个dock
   - 虽然R&P业务量仅占30%，但需要86%的出库dock资源

4. **R&P Reception**：用于R&P卸货
   - 容量：营业时段稳定保持1个dock
   - 特点：48周实际数据显示需求非常稳定

**时变容量**：
- dock数量根据每小时的实际需求动态调整
- 基于48周历史排班数据，取中位数

**资源分配策略**：
- 先到先服务（FCFS）：卡车按到达顺序排队
- 无法跨类别使用：FGdock不能给原料使用，反之亦然
- 无可用dock时，卡车进入等待队列

### 3.2 Buffer

缓冲区用于暂存工厂生产但DC尚未处理的货物。

**配置**：
- **FG缓冲区**：20辆挂车 × 每车33托盘 = 660托盘容量
- **R&P缓冲区**：15辆挂车 × 每车33托盘 = 495托盘容量

**运作机制**：
- **DC关闭时**：工厂24/7连续生产，产出进入缓冲区暂存
- **DC开放时**：优先释放缓冲区货物进行入库处理
- **溢出处理**：缓冲区满时，新产出的货物将溢出丢失（记录为异常事件）

**释放策略**：
- 先进先出（FIFO）：最早进入的货物优先释放
- 每30分钟检查一次
- FG每次最多释放150托盘，原料/包装每次最多释放100托盘

**验证发现**：
- FG缓冲区充足，99%时段仅使用26.5%容量
- R&P缓冲区基本充足，但历史上出现过1次极端峰值（622托盘）超出容量

### 3.3 人力资源

**人员配置**：
- 总人力：125 FTE
- FG团队：97 FTE（77.6%）
- R&P团队：28 FTE（22.4%）

**工作效率**：
- **R&P团队效率**：平均5.81托盘/小时/人，标准差0.416
  - 基于实际KPI数据
  - 每次作业效率有随机波动
  
- **FG团队效率**：平均3.5托盘/小时/人，标准差0.5
  - 基于估算值
  - 同样考虑随机波动

**效率模拟**：
- 使用正态分布生成每次作业的实际效率
- 设置下限为平均值的50%（避免异常低效率）
- 装卸时间 = 托盘数量 ÷ 效率

**待确认**：
- 活动分配比例：假设60%时间用于装卸货，25%用于入库，15%用于其他

---

## 4.Processes


### 4.1 货物生成流程（2个：FG+R&P）

24小时不间断生产，每小时产出固定数量的托盘。FG和原料/包装分别有独立的生产线。

**生产速率**：
- FG生产：每小时平均46托盘（基于月产33,000托盘计算）
- R&P生产：每小时平均23托盘（基于月产16,500托盘计算）
- 实际产出有随机波动（泊松分布）

**流程逻辑**：
```
每小时循环：
1. 生成本小时的产出托盘数
2. 检查DC状态：
   - 如果DC关闭（晚上/早晨）→ 货物进入缓冲区
      缓冲区有空间 → 成功存储
      缓冲区已满 → 溢出丢失（记录异常）
   - 如果DC开放 → 直接启动入库处理
3. 等待1小时，重复循环
```

**作用**：
- 模拟工厂与DC的时间错配（工厂24/7，DC有运营时间限制）

### 4.2 buffer释放流程

DC开门营业后，优先处理缓冲区中积压的货物，确保库存及时入库。

**触发条件**：
- DC处于运营时间内
- 缓冲区有待处理货物

**流程逻辑**：
```
每30分钟检查：
1. 检查R&P缓冲区：
   - 如果有货物 → 释放最多100托盘
   - 启动入库处理流程
2. 检查FG缓冲区：
   - 如果有货物 → 释放最多150托盘
   - 启动入库处理流程
3. 等待30分钟，重复检查
```

### 4.3 卡车到达

**到达模式**（混合模型）：
- **75%预约到达**：提前预定时段，到达时间较确定
- **25%临时到达**：未预约，到达时间随机


**到达率**（每小时平均卡车数）：
- FG卡车：
  - 高峰时段（10-13点）：3.15-3.21辆/小时
  - 平峰时段（7-9点）：2.47-2.8辆/小时
  - 低峰时段（晚间20-22点）：0.15-0.7辆/小时
  
- R&P卡车：
  - 高峰时段（19点）：1.42辆/小时
  - 平峰时段（全天）：0.77-1.14辆/小时
  - 低峰时段（早晨6点、晚间22-23点）：0.36-0.77辆/小时

**卡车装载量**（每车托盘数）：
- FG卡车：
  - 典型值：33托盘（最常见）
  - 平均值：30托盘
  - 变化范围：1-276托盘
  - 分布特征：集中在33托盘附近
  
- R&P卡车：
  - 典型值：22托盘（最常见）
  - 平均值：22.7托盘
  - 变化范围：1-560托盘
  - 分布特征：高度集中在22托盘

**流程逻辑**：
```
每小时循环：
1. 检查DC是否营业
2. 如果营业，分别处理FG和R&P：
   
   a) 根据当前小时查询到达率
   
   b) 计算到达数量：
      - 预约到达数 = 75% × 到达率
      - 临时到达数 = 泊松随机(25% × 到达率)
      - 总到达数 = 预约 + 临时
   
   c) 生成每辆卡车：
      - 随机生成装载量（三角分布）
      - 创建卡车实体
      - 添加到达延迟（避免同时到达造成拥堵）
      - 启动该卡车的出库处理流程
      
3. 等待1小时，重复
```

### 4.4 入库处理流程
**流程逻辑**：
```
对每批入库货物：
1. 确定需要的dock类型（FG入库或R&P入库）

2. 检查dock可用性：
   - 查询当前小时的dock配置
   - 如果无可用dock → 等待1小时后重试
   - 如果有可用dock → 继续

3. 请求dock资源：
   - 加入dock等待队列（如果dock繁忙）
   - 按先到先服务顺序等待
   - 获得dock后开始服务

4. 卸货操作：
   - 记录开始时间
   - 获取当前员工效率（随机生成）
   - 计算处理时间 = 托盘数 ÷ 效率
   - 执行卸货（仿真时间推进）
   - 记录结束时间

5. 释放dock，供下一批货物使用

6. 记录操作数据到KPI系统
```

**时间计算示例**：
- 100托盘的FG入库
- 员工效率：3.5托盘/小时/人
- 处理时间 = 100 ÷ 3.5 ≈ 28.6小时（理论值）
- 实际时间取决于分配的员工数量

### 4.5 出库处理流程

**流程逻辑**：
```
对每辆到达的卡车：
1. 确定需要的dock类型（FG出库或R&P出库）

2. 检查dock可用性：
   - 查询当前小时的dock配置
   - 如果无可用dock → 等待1小时后重试
   - 如果有可用dock → 继续

3. 请求dock资源：
   - 加入dock等待队列
   - 按到达顺序排队等待
   - 获得dock后开始服务

4. 记录服务开始时间：
   - 计算等待时间 = 服务开始 - 实际到达
   - 记录到KPI（用于评估服务质量）

5. 装货操作：
   - 获取当前员工效率（随机生成）
   - 计算装货时间 = 托盘数 ÷ 效率
   - 执行装货（仿真时间推进）
   - 记录结束时间

6. 服务水平检查（仅FG）：
   - 检查完成时间是否超过发运时限
   - 超时 → 记录SLA违约
   - 按时 → 正常完成

7. 释放dock，记录完成数据

8. 卡车离开
```

**关键性能指标**：
- 等待时间：衡量dock资源充足性
- SLA遵守率：衡量服务质量
- 完成数量：衡量吞吐能力

**时间计算示例**：
- FG卡车装载30托盘
- 到达时间：上午10:00
- 等待时间：15分钟（前面有1辆车在装货）
- 开始装货：10:15
- 装货效率：3.5托盘/小时/人
- 装货时长：30 ÷ 3.5 ≈ 8.6小时（多人并行会更快）
- 完成时间：约下午6:45
- 发运时限：下午6:00（到达后8小时）
- 结果：超时45分钟，记录SLA违约

### 4.6 buffer监控流程

**监控内容**：
- FG缓冲区当前托盘数和占用率
- R&P缓冲区当前托盘数和占用率

**流程逻辑**：
```
每小时循环：
1. 获取当前时间
2. 计算R&P缓冲区占用率 = 当前托盘数 ÷ 495
3. 计算FG缓冲区占用率 = 当前托盘数 ÷ 660
4. 记录到KPI数据库
5. 等待1小时，重复
```

**预警**：
- 占用率 > 80%：高占用预警
- 占用率 > 95%：临近溢出预警
- 溢出发生：记录异常事件

### 4.7 dock容量更新流程

根据预设的排班计划，每小时更新各类dock的可用数量。每个整点（如8:00, 9:00）自动更新

数据来源：基于48周历史排班数据的中位数配置

**流程逻辑**：
```
每小时循环：
1. 获取当前小时（0-23）

2. 查询该小时的dock配置：
   - FG出库dock数
   - FG入库dock数
   - R&P出库dock数
   - R&P入库dock数

3. 更新系统配置变量

4. 等待到下一个整点，重复
```

---

## 5.Events

### 5.1 到达类

**卡车到达事件**：
- 触发时机：外部卡车抵达DC
- 频率：每小时数辆，基于到达率
- 后续动作：启动出库处理流程
- 业务影响：增加dock需求，可能产生等待队列

**货物到达事件**：
- 触发时机：工厂生产完成，货物送达
- 频率：每小时固定发生
- 后续动作：进入缓冲区或直接入库
- 业务影响：增加库存或缓冲区占用

### 5.2 资源类

**dock请求事件**：
- 触发时机：卡车或货物需要dock服务
- 频率：每个服务请求触发
- 后续动作：
  - dock空闲 → 立即占用
  - dock繁忙 → 加入等待队列

**dock占用事件**：
- 触发时机：获得dock使用权
- 持续时间：装卸货完成前
- 业务影响：dock对其他请求不可用

**dock释放事件**：
- 触发时机：装卸货完成
- 后续动作：
  - 队列为空 → dock空闲
  - 队列有等待 → 下一个请求占用

### 5.3 服务类

**装货服务事件**：
- 触发时机：卡车占用出库dock
- 持续时间：托盘数 ÷ 员工效率
- 服务完成：卡车离开，dock释放
- 记录数据：等待时间、服务时间、SLA状态

**卸货服务事件**：
- 触发时机：货物占用入库dock
- 持续时间：托盘数 ÷ 员工效率
- 服务完成：货物入库，dock释放
- 记录数据：处理时间、来源（缓冲区/直接）

**缓冲区释放事件**：
- 触发时机：DC开门后每30分钟
- 释放量：FG最多150托盘，R&P最多100托盘
- 后续动作：启动入库处理流程

### 5.4 容量类

**缓冲区溢出事件**：
- 触发时机：货物无法进入已满的缓冲区
- 频率：不定（容量接近满载时可能发生）
- 后续处理：货物丢失，记录异常
- 业务影响：生产损失，需要分析原因

**dock容量更新事件**：
- 触发时机：每个整点
- 更新内容：4类dock的可用数量
- 业务影响：
  - 增加容量 → 等待队列可能快速消化
  - 减少容量 → 可能产生新的等待

### 5.5 监控记录

**占用率记录事件**：
- 触发时机：每小时
- 记录内容：两个缓冲区的占用百分比
- 用途：识别容量瓶颈，评估设施充足性

**等待时间记录事件**：
- 触发时机：卡车开始服务时
- 记录内容：从到达到开始服务的时长
- 用途：评估服务效率，识别拥堵时段

**SLA检查事件**：
- 触发时机：FG卡车装货完成时
- 检查内容：是否在时限内完成
- 记录结果：按时完成或违约
- 用途：评估客户服务水平

**完成记录事件**：
- 触发时机：每次装卸货完成
- 记录内容：货物数量、耗时、类别等
- 用途：统计吞吐量，分析效率

---

## 6.概率分布

### 6.1 混合分布（卡车到达）

**用途**：模拟卡车到达数量

**分布形式**：
- 75%确定性成分：预约到达，数量相对稳定
  - 计算方式：到达率 × 0.75，四舍五入取整
  - 例如：到达率3.2辆/小时 → 预约2辆（int(3.2×0.75+0.5)=2）
  
- 25%随机性成分：临时到达，数量随机波动
  - 计算方式：泊松分布，参数 = 到达率 × 0.25
  - 例如：到达率3.2辆/小时 → 临时平均0.8辆，实际可能0、1或2辆

**选择依据**：
- 实际数据验证发现到达比纯随机更规律
- 方差仅为均值的30-48%（泊松分布应为100%）
- 说明存在预约系统，大部分卡车提前安排时段

**含义**：
- 到达有一定可预测性（有利于排班）
- 仍有部分随机性（需要应对临时需求）
- 比完全随机模型更接近实际情况

### 6.2 三角分布（托盘装载量）

**用途**：模拟每辆卡车或每批货物的托盘数量

**分布参数**：
- **FG**：
  - 最小值：1托盘
  - 众数（峰值）：33托盘
  - 最大值：276托盘
  - 典型值：大部分在20-40托盘之间
  
- **R&P**：
  - 最小值：1托盘
  - 众数（峰值）：22托盘
  - 最大值：560托盘
  - 典型值：大部分在15-30托盘之间

**分布特征**：
- 单峰分布，围绕众数集中
- 有明确的上下界（不会出现负值或异常大值）
- 允许偶尔的极端值（如276或560托盘的大批次）

**选择依据**：
- 基于33,280批次实际数据统计
- 三角分布简单且符合数据特征
- 容易参数化（只需最小、众数、最大三个值）

**含义**：
- FG批次通常比R&P大（30 vs 22.7托盘）
- 存在标准批次（33和22托盘最常见）
- 偶尔有大批量订单需要特殊处理

### 6.3 正态分布（员工效率）

**用途**：模拟员工的实际工作效率（托盘/小时/人）

**分布参数**：
- **R&P团队**：
  - 平均效率：5.81托盘/小时/人
  - 标准差：0.416托盘/小时/人
  - 变异系数：7.2%（相对稳定）
  
- **FG团队**：
  - 平均效率：3.5托盘/小时/人
  - 标准差：0.5托盘/小时/人
  - 变异系数：14.3%（波动稍大）

**分布特征**：
- 对称分布，大部分值接近平均值
- 考虑下限截断（最低为平均值的50%）
- 避免出现负值或异常低效率

**选择依据**：
- 人员效率通常呈正态分布
- R&P数据来自实际KPI统计
- FG数据基于行业经验估算

**业务含义**：
- 每次作业效率略有不同（员工状态、货物特性等）
- R&P效率更高但操作复杂度大（需要更多dock）
- FG效率较低但流程标准化（dock需求少）

### 6.4 泊松分布（工厂产出）

**用途**：模拟工厂每小时的实际产出数量

**分布参数**：
- FG：平均46托盘/小时
- R&P：平均23托盘/小时

**分布特征**：
- 离散分布，产出为整数（不会有0.5托盘）
- 围绕平均值随机波动
- 方差等于均值（泊松特性）

**选择依据**：
- 生产过程的标准建模方法
- 反映生产中的随机波动（设备状态、原料供应等）

**含义**：
- 虽然计划产量固定，但实际执行有波动
- 某些小时可能多产或少产
- 长期平均符合计划目标

### 6.5 指数分布（到达间隔）

**用途**：模拟同一小时内卡车到达的时刻分散

**分布参数**：
- 平均间隔：0.25小时（15分钟）

**分布特征**：
- 无记忆性：前一辆到达不影响后一辆
- 大部分间隔较短，偶尔有较长间隔
- 确保卡车不会在同一时刻同时到达

**选择依据**：
- 到达过程的经典方法
- 避免仿真中的同时到达造成的不真实拥堵

**含义**：
- 虽然一小时有多辆车，但到达时刻分散
- 更真实地反映实际到达模式
- 平滑dock需求，避免瞬时峰值

## 7.KPI

### 7.1 服务效率指标
**卡车平均等待时间**：
- 定义：从到达到开始服务的平均时长
- 单位：小时
- 目标：越短越好
- 业务含义：反映dock资源充足性和服务效率

**dock利用率**：
- 定义：dock被占用的时间百分比
- 单位：百分比（0-100%）
- 目标：60-80%（太低浪费，太高拥堵）
- 业务含义：资源配置是否合理

### 7.2 服务质量指标

**SLA遵守率**：
- 定义：按时完成发货的订单百分比
- 单位：百分比（0-100%）
- 目标：≥ 95%
- 业务含义：客户满意度和服务可靠性

**SLA违约次数**：
- 定义：超时完成的订单数量
- 单位：次数
- 目标：0次
- 业务含义：需要改进的异常事件

**平均延迟时长**（仅违约订单）：
- 定义：超出时限的平均时间
- 单位：小时
- 业务含义：违约严重程度

### 7.3 容量管理指标

**缓冲区平均占用率**：
- 定义：缓冲区使用量的平均百分比
- 单位：百分比
- 目标：< 80%（预留安全余量）
- 业务含义：缓冲区容量是否充足

**缓冲区溢出次数**：
- 定义：货物因缓冲区满而丢失的事件数
- 单位：次数
- 目标：0次
- 业务含义：严重异常，需要立即处理

**溢出托盘总数**：
- 定义：因溢出丢失的托盘数量
- 单位：托盘
- 业务含义：生产损失的量化

### 7.4 吞吐量指标

**完成订单数量**：
- 定义：成功处理的出库卡车数
- 单位：辆
- 业务含义：系统吞吐能力

**处理托盘总数**：
- 定义：入库+出库的托盘总量
- 单位：托盘
- 业务含义：业务总量

**每日平均吞吐量**：
- 定义：平均每天处理的托盘数
- 单位：托盘/天
- 业务含义：日常运营能力

<!--
---

## 9.模型验证与校准

### 9.1 已验证部分

以下参数基于实际业务数据，已通过验证：

1. **dock容量配置**（96个数值）
   - 数据来源：48周历史排班表
   - 验证方法：统计中位数
   - 可信度：高

2. **卡车到达模式**（36个数值）
   - 数据来源：306天实际到达记录
   - 验证方法：统计检验（卡方、K-S检验）
   - 修正：从纯随机改为混合模型
   - 可信度：高

3. **托盘装载量分布**（12个参数）
   - 数据来源：33,280批次实际数据
   - 验证方法：分布拟合分析
   - 可信度：高

4. **缓冲区容量**（6个参数）
   - 数据来源：实际需求统计
   - 验证方法：峰值需求分析
   - 发现：R&P曾有1次溢出事件
   - 可信度：中（需确认极端值）

5. **人员配置**（3个参数）
   - 数据来源：实际工时统计
   - 验证方法：工时总量计算
   - 可信度：高

6. **工作效率**（4个参数）
   - 数据来源：KPI绩效数据
   - 验证方法：直接提取
   - 可信度：中（FG为估算）

7. **工厂生产率**（2个参数）
   - 数据来源：月度生产计划
   - 验证方法：产量目标换算
   - 可信度：高

### 9.2 待验证部分

以下参数基于假设，需要实际数据验证：

1. **人员活动分配比例**
   - 当前假设：60%装卸、25%入库、15%其他
   - 需要数据：实际活动工时分布
   - 影响：效率计算的准确性

2. **SLA时限**
   - 当前假设：8小时
   - 需要数据：合同或运营规定
   - 影响：SLA遵守率的评估

3. **缓冲区挂车容量**
   - 当前假设：每车33托盘
   - 需要数据：实际挂车标准容量
   - 影响：缓冲区总容量计算



### 9.3 模型局限性

**已知简化**：

1. **库存管理简化**：
   - 假设库存无限，不考虑库容约束
   - 实际：库房有物理空间限制

2. **路径优化忽略**：
   - 假设库内搬运瞬时完成
   - 实际：有搬运距离和时间

3. **人员调配固定**：
   - 假设人员按固定比例分配
   - 实际：可能动态调配，应对突发需求

4. **设备故障未考虑**：
   - 假设所有设备正常运行
   - 实际：偶有故障停机

5. **季节波动简化**：
   - 使用全年平均数据
   - 实际：可能有明显的淡旺季差异

**适用范围**：
- 适用于中长期（月度/季度）战略决策
- 适用于运营时间调整的影响评估
- 不适用于短期（日/周）详细排班
- 不适用于极端异常情况分析

---

-->

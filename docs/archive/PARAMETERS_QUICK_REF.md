# 仿真参数与结构 - 快速参考

## 📊 仿真参数总览

### 1️⃣ 核心参数 (29个)

#### ✅ 基于实际数据 (15个) - 最可靠

| 参数 | 值 | 来源 |
|------|-----|------|
| **R&P 平均效率** | 5.81 托盘/小时 | KPI sheet (11个月平均) |
| **R&P 效率标准差** | 0.416 | KPI sheet (11个月) |
| **FG 平均效率** | 3.5 托盘/小时 | KPI sheet (11个月平均) |
| **FG 效率标准差** | 0.5 | KPI sheet (调整后) |
| **每小时到达率** | 0.5-5.1 卡车/小时 | Total Shipments (11月) |

**数据质量**: ⭐⭐⭐⭐⭐ (11个月真实运营数据)

---

#### 📊 计算推导 (4个) - 可靠

| 参数 | 值 | 计算方法 |
|------|-----|---------|
| **R&P 工厂生产** | 23 托盘/小时 | 月入库 ÷ 30天 ÷ 24小时 |
| **FG 工厂生产** | 46 托盘/小时 | 月入库 ÷ 30天 ÷ 24小时 |
| **R&P 缓冲总容量** | 495 托盘 | 15辆 × 33托盘 |
| **FG 缓冲总容量** | 660 托盘 | 20辆 × 33托盘 |

**数据质量**: ⭐⭐⭐⭐ (基于实际数据推算)

---

#### 📐 合理估算 (7个) - 需验证

| 参数 | 值 | 估算依据 |
|------|-----|---------|
| **FG 入库码头** | 10 个 | 时位容量推断 |
| **FG 出库码头** | 12 个 | FG业务量约2倍R&P |
| **R&P 入库码头** | 8 个 | 时位容量推断 |
| **R&P 出库码头** | 6 个 | 相对FG较少 |
| **总FTE** | 50 人 | 工作量反推 |
| **R&P 挂车数** | 15 辆 | 6小时累积+余量 |
| **FG 挂车数** | 20 辆 | 6小时累积+余量 |

**数据质量**: ⭐⭐⭐ **建议**: 现场验证

---

#### ⚠️ 假设值 (3个) - 建议替换

| 参数 | 值 | 假设依据 |
|------|-----|---------|
| **FG 发运间隔** | 2 小时 | 一般物流规律 |
| **装车提前时间** | 2 小时 | 经验值 |
| **到达延迟** | 0.25 小时 (平均) | 行业标准 |

**数据质量**: ⭐⭐ **建议**: 从实际调度获取

---

## 🏗️ 仿真结构

### 三层架构

```
┌─────────────────────────────────────────┐
│          1. 配置层 (Configuration)       │
│  • 场景定义 (4个场景)                    │
│  • 系统参数 (29个参数)                   │
│  • 随机种子 (可重复性)                   │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│         2. 执行层 (Execution)            │
│  SimPy 离散事件仿真引擎                  │
│  ├─ 7个并行进程                         │
│  ├─ 4类资源管理                         │
│  ├─ 事件调度器                          │
│  └─ KPI 收集器                          │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│          3. 输出层 (Output)              │
│  • Excel 报告 (对比+详细)                │
│  • 可视化图表 (6个子图)                  │
│  • JSON 配置文件                         │
└─────────────────────────────────────────┘
```

---

### 7个并行进程

| 进程 | 功能 | 触发频率 |
|------|------|---------|
| 1️⃣ **工厂生产(R&P)** | 24/7生产 → 缓冲区/直接入库 | 每小时 |
| 2️⃣ **工厂生产(FG)** | 24/7生产 → 缓冲区/直接入库 | 每小时 |
| 3️⃣ **缓冲区释放** | DC开门时优先处理缓冲区 | 每30分钟 |
| 4️⃣ **卡车到达** | 泊松分布到达 → 出库处理 | 每小时 |
| 5️⃣ **FG订单生成** | 根据发运时间表生成订单 | 按时刻表 |
| 6️⃣ **午夜检查** | 检查未完成订单积压 | 每日24:00 |
| 7️⃣ **缓冲监控** | 记录缓冲区占用率 | 每小时 |

---

### 4类资源管理

```
1. 码头资源 (SimPy Resource)
   ├─ FG_Reception: 容量 10
   ├─ FG_Loading: 容量 12
   ├─ RP_Reception: 容量 8
   └─ RP_Loading: 容量 6

2. 缓冲区 (TrailerBuffer)
   ├─ R&P: 495 托盘 (15辆挂车)
   └─ FG: 660 托盘 (20辆挂车)

3. 人力资源 (FTEManager)
   └─ 总计 50 FTE (动态分配)

4. 订单队列 (pending_orders)
   └─ FG 订单管理
```

---

## 🔄 数据流程

### 输入 → 处理 → 输出

```
Excel 数据文件
    ↓
data_preparation.py (参数提取)
    ↓
simulation_config.json (配置文件)
    ↓
dc_simulation.py (仿真运行)
    ↓
结果文件:
  • simulation_results_comparison.xlsx
  • simulation_details_*.xlsx
  • simulation_results_visualization.png
```

---

### 单次仿真流程

```
1. 加载场景配置 (如: 06:00-24:00)
2. 初始化 SimPy 环境
3. 创建资源 (码头、缓冲、FTE、KPI)
4. 启动7个进程
5. 运行仿真 (30天 × 24小时 = 720小时)
6. 收集 KPI
7. 生成报告
8. 输出结果
```

---

## 🎯 关键特性

### 随机性建模

| 事件 | 分布 | 参数 |
|------|------|------|
| **效率波动** | 正态分布 | N(5.81, 0.416) for R&P |
| **卡车到达** | 泊松分布 | λ = 0.5-5.1 (按小时) |
| **到达延迟** | 指数分布 | Exp(0.25) 平均15分钟 |

### 缓冲机制逻辑

```python
if DC 关闭:
    if 缓冲区有空间:
        托盘 → 缓冲区
    else:
        记录溢出事件  # KPI
else:
    优先释放缓冲区 → 处理
    新托盘 → 直接处理
```

### SLA 检查逻辑 (FG)

```python
截单时间 = 发运时间 - 2小时

if 订单完成时间 > 发运时间:
    记录 SLA 延误  # KPI
```

---

## 📈 输出 KPI

### 6个核心指标

| KPI | 计算方法 | 目标 |
|-----|---------|------|
| **SLA遵守率** | 准时订单 / 总订单 × 100% | ≥ 95% |
| **缓冲溢出** | 溢出事件数 & 溢出托盘数 | 0 |
| **午夜积压** | 24:00时未完成托盘数 | 趋近0 |
| **等待时间** | 服务开始 - 到达时间 | 最小化 |
| **缓冲占用率** | 当前托盘 / 最大容量 × 100% | < 80% |
| **处理总量** | 入库+出库托盘总数 | 最大化 |

---

## ⚙️ 如何修改参数

### 快速定位

```python
# 打开 dc_simulation.py

# 第 18-47 行: SIMULATION_CONFIG
# → 修改场景 (DC运营时间)

# 第 50-100 行: SYSTEM_PARAMETERS
# → 修改效率、缓冲、码头、FTE等

# 第 755 行: run_scenario_comparison()
# → 修改运行参数 (重复次数、天数)
```

### 示例：增加缓冲容量

```python
# 位置: 第 67-72 行
'buffer_capacity': {
    'rp_trailers': 20,  # 从 15 改为 20
    'fg_trailers': 30,  # 从 20 改为 30
    'pallets_per_trailer': 33
}
```

---

## 📁 相关文件

### 必读文档
1. **SIMULATION_PARAMETERS_GUIDE.md** - 完整参数指南 (本文档详细版)
2. **simulation_framework.md** - 理论框架
3. **README_SIMULATION.md** - 使用指南

### 可视化图表
1. **simulation_parameter_hierarchy.png** - 参数层次结构
2. **simulation_data_flow.png** - 数据流程图
3. **simulation_parameter_table.png** - 参数汇总表

### 核心代码
1. **dc_simulation.py** - 主仿真程序 (913行)
2. **data_preparation.py** - 数据提取脚本
3. **simple_simulation_demo.py** - 简化示例

---

## 🚀 快速开始

```bash
# 1. 查看参数
python visualize_parameters.py

# 2. 验证效率数据
python check_efficiency.py

# 3. 准备数据 (可选，如果有Excel文件)
python data_preparation.py

# 4. 运行仿真
python dc_simulation.py

# 5. 查看结果
# - simulation_results_comparison.xlsx
# - simulation_results_visualization.png
```

---

## ✅ 数据质量评估

| 可信度 | 参数数量 | 建议 |
|--------|---------|------|
| ⭐⭐⭐⭐⭐ | 15 | ✅ 无需改进 (实际数据) |
| ⭐⭐⭐⭐ | 4 | ✅ 可接受 (计算推导) |
| ⭐⭐⭐ | 7 | ⚠️ 建议现场验证 |
| ⭐⭐ | 3 | ⚠️ 建议替换为实际数据 |

---

**最后更新**: 2026-01-08  
**版本**: 1.0  
**作者**: Design Project Group 18

# 仿真参数配置 - 基于实际数据提取结果

## 2026年1月8日更新 - 修正参数来源

---

## ✅ 已修正：码头容量实际分配

### 从Timeslot 48周数据提取的FG和R&P实际容量

根据 `analyze_hourly_capacity.py` 的最新分析结果：

```python
# FG码头容量（按小时中位数）
'fg_dock_capacity': {
    'loading': {  # FG出库码头
        6: 1, 7: 1, 8: 1, 9: 1, 10: 1, 11: 1, 
        12: 1, 13: 1, 14: 1, 15: 1, 16: 1, 17: 1,
        18: 1, 19: 1, 20: 1, 21: 1, 22: 1, 23: 1
    },
    'reception': {  # FG入库码头
        6: 2, 7: 2, 8: 2, 9: 2, 10: 2, 11: 2,
        12: 2, 13: 2, 14: 2, 15: 2, 16: 2, 17: 2,
        18: 2, 19: 2, 20: 2, 21: 2, 22: 1, 23: 0
    }
}

# R&P码头容量（按小时中位数）
'rp_dock_capacity': {
    'loading': {  # R&P出库码头
        6: 4, 7: 6, 8: 5, 9: 5, 10: 5, 11: 6,
        12: 5, 13: 6, 14: 6, 15: 5, 16: 5, 17: 4,
        18: 4, 19: 4, 20: 3, 21: 3, 22: 3, 23: 3
    },
    'reception': {  # R&P入库码头
        6: 1, 7: 1, 8: 1, 9: 1, 10: 1, 11: 1,
        12: 1, 13: 1, 14: 1, 15: 1, 16: 1, 17: 1,
        18: 1, 19: 1, 20: 1, 21: 1, 22: 1, 23: 1
    }
}
```

### 关键发现

1. **FG vs R&P 码头分配实际比例**:
   - Loading峰值: FG 1个 vs R&P 6个 (约 14:86，**不是假设的70:30！**)
   - Reception峰值: FG 2个 vs R&P 1个 (约 67:33)
   
2. **R&P占用更多Loading码头**:
   - 这与业务量比例相反（FG业务量更大）
   - 可能原因：R&P装车更复杂/慢，需要更多码头

3. **时变特性明显**:
   - R&P Loading: 3-6个码头变化（变幅100%）
   - FG相对稳定

---

## ⚠️ 待提取：托盘分布

### 当前使用的参数（需验证）

```python
'pallets_distribution': {
    'min': 20,
    'max': 35,
    'mean': 27.5,
    'std': 5.0  # 假设
}
```

### 数据来源

需要从以下文件提取：
- `KPI sheet 2025.xlsx` - 可能有平均托盘/订单
- 或从业务人员获取实际装车托盘数统计

### 建议

如果暂时无法获取实际分布数据，当前假设（20-35托盘）是合理的：
- 标准卡车容量：33托盘
- 允许少量变动：±6托盘

---

## ✅ 已确认：其他实际数据参数

### 1. 卡车到达率（305天全年数据）
来源：`Total Shipments 2025.xlsx`

```python
'truck_arrival_rates': {
    'FG': {6: 1.62, 7: 2.8, 8: 2.47, ...},  # 17个时段
    'R&P': {6: 0.77, 7: 1.13, 8: 1.13, ...}  # 20个时段
}
```

### 2. 效率参数（11个月数据）
来源：`KPI sheet 2025.xlsx`

```python
'efficiency': {
    'rp': {'mean': 5.81, 'std': 0.42},  # 托盘/小时
    'fg': {'mean': 3.5, 'std': 0.5}
}
```

### 3. 工厂生产速率（计算得出）
基于效率反推：

```python
'factory_production': {
    'rp': 23,  # 托盘/小时
    'fg': 46
}
```

### 4. FTE资源（实际工时）
来源：`KPI sheet 2025.xlsx`

```python
'fte_total': 125  # 21,632h/月 ÷ 176h/人/月
'fte_allocation': {
    'rp_baseline': 28,  # 4,538h ÷ 176
    'fg_baseline': 97   # 17,094h ÷ 176
}
```

---

## 🔄 FTE动态分配（待更新）

### 当前状态

使用假设的动态调整比例：

```python
# dc_simulation.py 第651-674行
if buffer_level > threshold:
    rp_ratio = 0.35  # 假设！
    fg_ratio = 0.65  # 假设！
```

### 等待数据

你提到："后续我有一个不同活动的比例统计来分配"

建议新的参数结构：

```python
'fte_activity_ratios': {
    'inbound_processing': 0.40,  # 40%时间处理入库
    'outbound_processing': 0.35,  # 35%时间处理出库
    'buffer_handling': 0.15,      # 15%时间处理缓冲区
    'other': 0.10                 # 10%其他活动
}
```

---

## ⏳ 缓冲区容量（基于计算，需验证）

### 当前配置

```python
'buffer_capacity': {
    'rp': 50,   # 托盘
    'fg': 100
}
```

### 计算依据

```python
# DC关闭6小时 × 工厂生产速率 × 1.2安全系数
R&P: 23托盘/h × 6h × 1.2 = 165托盘 → 约50托盘/挂车 × 3.3挂车 ≈ 50托盘显示
FG:  46托盘/h × 6h × 1.2 = 331托盘 → 约33托盘/挂车 × 10挂车 ≈ 100托盘显示
```

### 需要确认

1. 实际缓冲区能容纳多少挂车？
2. 是否有物理空间限制？
3. 安全库存策略是什么？

---

## 📋 更新清单

### 已完成 ✅
- [x] 提取FG和R&P实际码头容量分配
- [x] 修正analyze_hourly_capacity.py脚本
- [x] 生成详细分析报告

### 进行中 🔄
- [ ] 提取托盘分布实际数据
- [ ] 等待FTE活动比例数据
- [ ] 验证缓冲区容量假设

### 下一步 📝
1. 更新dc_simulation.py中的码头容量参数结构
2. 使用实际FG/R&P分配替代70:30假设
3. 重新运行仿真验证模型
4. 文档更新参数来源说明

---

## 💡 关键改进

**之前（错误）**:
```python
# 总容量按假设比例分配
'loading': {6: 6, ...},  # 总容量
'fg_ratio': 0.70,  # 假设70%给FG
'rp_ratio': 0.30   # 假设30%给R&P
```

**现在（正确）**:
```python
# 直接使用实际分类数据
'fg_loading': {6: 1, 7: 1, ...},  # FG实际容量
'rp_loading': {6: 4, 7: 6, ...}   # R&P实际容量
```

这个修正对仿真结果的影响可能很大，因为**R&P实际占用的Loading码头远超业务量占比**！

---

**更新时间**: 2026-01-08  
**状态**: 码头容量已修正，托盘分布待提取
